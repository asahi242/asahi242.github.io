<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>利用css获取图片主色调颜色</title>
    <url>/2022/03/11/%E5%88%A9%E7%94%A8css%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E4%B8%BB%E8%89%B2%E8%B0%83%E9%A2%9C%E8%89%B2/</url>
    <content><![CDATA[<div style="width:100px;height:100px background-color:red;"></div>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;height:300px;float:right;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:500px;height:300px;background-size:100% 100%&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pic&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> imgSrc = <span class="string">&quot;4add7f57b8013fdda379730a45d9d38a.jpg&quot;</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">const</span> imgEle = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>)</span></span><br><span class="line"><span class="javascript">		<span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">&#x27;canvas&#x27;</span>)</span></span><br><span class="line"><span class="javascript">		imgEle.src = imgSrc</span></span><br><span class="line"><span class="javascript">		imgEle.onload = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> naturalImgSize = [imgEle.naturalWidth, imgEle.naturalHeight];</span></span><br><span class="line"><span class="javascript">			canvas.width = naturalImgSize[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">			canvas.height = naturalImgSize[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">			<span class="comment">//绘制到canvas</span></span></span><br><span class="line"><span class="javascript">			ctx.drawImage(imgEle, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取imageData：rgba像素点</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> imgData = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> leftSectionData = []</span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> rightSectionData = []</span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> onelineImgDataLen = canvas.width * <span class="number">4</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">			imgData.data.forEach(<span class="function">(<span class="params">colorVal, i</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> (i % onelineImgDataLen &lt;= <span class="number">0.5</span> * onelineImgDataLen || i % onelineImgDataLen &gt;= <span class="number">0.6</span> * onelineImgDataLen) &#123;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">const</span> inLeft = i % onelineImgDataLen &lt;= <span class="number">0.5</span> * onelineImgDataLen</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> (i % <span class="number">4</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">						<span class="comment">// 获取rgb均值</span></span></span><br><span class="line"><span class="javascript">						<span class="keyword">const</span> curAverageRGB = (imgData.data[i] + imgData.data[i + <span class="number">1</span>] + imgData.data[i + <span class="number">2</span>]) / <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript">						<span class="keyword">let</span> leftOrRightRef = inLeft ? leftSectionData : rightSectionData;</span></span><br><span class="line"><span class="javascript">						<span class="comment">//每个数组里存四个值：本颜色值中的r、g、b的均值，以及r、g、b三个值。</span></span></span><br><span class="line"><span class="javascript">						<span class="comment">//均值一方面用于累加计算本区域的整体均值，然后再跟每个均值对比拿到与整体均值最接近的项的索引，再取该数组里的后三个值：rgb，对应着颜色</span></span></span><br><span class="line"><span class="javascript">						leftOrRightRef[leftOrRightRef.length] = [curAverageRGB, imgData.data[i], imgData.data[i + <span class="number">1</span>], imgData.data[i + <span class="number">2</span>]]</span></span><br><span class="line"><span class="javascript">					&#125;</span></span><br><span class="line"><span class="javascript">				&#125;</span></span><br><span class="line"><span class="javascript">			&#125;)</span></span><br><span class="line"><span class="javascript">			<span class="comment">//generate average rgb</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> averageOfLeft = <span class="built_in">Math</span>.round(leftSectionData.reduce(<span class="function">(<span class="params">_cur, item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">return</span> _cur + item[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">			&#125;, <span class="number">0</span>) / leftSectionData.length)</span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> averageOfRight = <span class="built_in">Math</span>.round(rightSectionData.reduce(<span class="function">(<span class="params">_cur, item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">return</span> _cur + item[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">			&#125;, <span class="number">0</span>) / rightSectionData.length)</span></span><br><span class="line"><span class="javascript">			<span class="comment">//find the most near color</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> findNearestIndex = <span class="function">(<span class="params">averageVal, arrBox</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">let</span> _gapValue = <span class="built_in">Math</span>.abs(averageVal - arrBox[<span class="number">0</span>])</span></span><br><span class="line"><span class="javascript">				<span class="keyword">let</span> _nearColorIndex = <span class="number">0</span></span></span><br><span class="line"><span class="javascript">				arrBox.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">const</span> curGapValue = <span class="built_in">Math</span>.abs(item - averageVal)</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> (curGapValue &lt; _gapValue) &#123;</span></span><br><span class="line"><span class="javascript">						_gapValue = curGapValue</span></span><br><span class="line"><span class="javascript">						_nearColorIndex = index</span></span><br><span class="line"><span class="javascript">					&#125;</span></span><br><span class="line"><span class="javascript">				&#125;)</span></span><br><span class="line"><span class="javascript">				<span class="keyword">return</span> _nearColorIndex</span></span><br><span class="line"><span class="javascript">			&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> leftNearestColor = leftSectionData[findNearestIndex(averageOfLeft, leftSectionData)]</span></span><br><span class="line"><span class="javascript">			<span class="keyword">const</span> rightNearestColor = rightSectionData[findNearestIndex(averageOfRight, rightSectionData)]</span></span><br><span class="line"><span class="javascript">			<span class="built_in">console</span>.log(leftNearestColor,rightNearestColor)</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.getElementById(<span class="string">&quot;pic&quot;</span>).style.backgroundImage = <span class="string">`url(`</span>+imgSrc+<span class="string">`)`</span>;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">document</span>.getElementById(<span class="string">&quot;box&quot;</span>).style.backgroundImage =  <span class="string">`linear-gradient(90deg,rgba(<span class="subst">$&#123;leftNearestColor[<span class="number">1</span>]&#125;</span>,<span class="subst">$&#123;leftNearestColor[<span class="number">2</span>]&#125;</span>,<span class="subst">$&#123;leftNearestColor[<span class="number">3</span>]&#125;</span>,1) 0%,rgba(<span class="subst">$&#123;rightNearestColor[<span class="number">1</span>]&#125;</span>,<span class="subst">$&#123;rightNearestColor[<span class="number">2</span>]&#125;</span>,<span class="subst">$&#123;rightNearestColor[<span class="number">3</span>]&#125;</span>,1) 100%`</span></span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img  src="/assets/2022-03-11/%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E4%B8%BB%E8%89%B2%E8%B0%832022-03-11.jpg"  ><span class="image-caption">展示图片</span></p>
<iframe src="/assets/2022-03-11/2022-03-11.html" style="width:100%;height;500px;"></iframe>]]></content>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>第一篇文章</title>
    <url>/2022/03/11/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/</url>
    <content><![CDATA[<p>我不会写作,就是写着玩的!</p>
]]></content>
  </entry>
</search>
